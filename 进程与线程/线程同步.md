## 线程同步

#### 1. 线程安全

> 在使用其他库或者接口时，先假设它们不是线程安全的，直到最后被证实它们是线程安全的。

#### 2. Mutex（互斥量）

可以通过使用pthread的互斥接口保护数据，确保同一时刻只有一个线程访问数据。

> Mutex本质上是一把锁，在访问共享资源前对互斥量进行加锁，在访问完成后释放互斥量上的锁。
>
> 对互斥量进行加锁后，任何其他试图再次对互斥量加锁的线程都会被阻塞直到当前线程释放该互斥锁。

互斥量用pthread_mutex_t数据类型表示，在使用互斥量之前，必须对它进行初始化，初始化方式有两种：

1. 把互斥量设置为常量`PTHREAD_MUTEX_INITIALIZER`（只对静态分配的互斥量）
2. 通过调用`pthread_mutex_init`函数进行初始化

如果动态地分配互斥量，例如通过调用malloc函数，那么在释放内存前需要调用`pthread_mutex_destroy`

```c
#include <pthread.h>
int pthread_mutex_init(pthread_mutex_t *restrict mutex,
                      const pthread_mutexattr_t *restrict attr);
int pthread_mutex_destroy(pthread_mutex_t *mutex);
```

