## 闭包

#### 1 什么是闭包？

> 闭包本质上是一个函数，它是一个封闭的包裹，里面包裹着自由变量，哪里可以访问这个包裹，哪里就可以访问自由变量。这些自由变量始终保存在内存中。

#### 2 为什么要使用闭包？

1. 闭包避免使用全局变量
2. 闭包允许函数将其所操作的某些数据（环境）关联起来，这一点与类相似
3. 一般来说，当对象中只有一个方法时，使用闭包是更好的选择

```python
def adder(x):
    def wrapper(y):
        return x + y
    return wrapper
>>> adder5 = adder(5)
>>> adder5(10)
15
>>> adder5(6)
11
```

这比用类来实现更优雅，装饰器也是基于闭包的一种应用场景。

**所有函数都有一个`__closure__`属性，如果这个函数是闭包函数的话，那么它返回的是一个由cell对象组成的元组对象。cell对象的cell_contents属性就是闭包中的自由变量**

```python
>>> adder.__closure__
>>> adder5.__closure__
(<cell at 0x103075910: int object at 0x7fd25160451>,)
>>> adder5.__closure__[0].cell_contents
5
```

这解释了为什么局部变量脱离函数之后，还可以在函数之外被访问的原因的，因为它存储在了闭包的 cell_contents中了。

