## TCP拥塞控制

#### 1. 拥塞控制算法

在TCP协议中，拥塞控制是通过拥塞窗口来完成的，拥塞窗口的大小会随着网络状况实时调整。

拥塞控制算法：

* 慢启动

  拥塞控制常用算法有“慢启动”，它通过一定的规则，慢慢地将网络发送数据的速率增加到一个阈值。超过这个阈值之后，慢启动就结束了。

* 拥塞避免

  在这个阶段，TCP会不断地探测网络状况，并随之不断调整拥塞窗口的大小。

在任何时刻，TCP发送缓冲区的数据是否能被真正发送出去，至少取决于两个因素，一个是**当前的发送窗口大小**，另一个是**拥塞窗口大小**，而TCP协议中总是取两者中最小值作为判断依据。

例如，当前发送的字节为100， 发送窗口的大小是200，拥塞窗口的大小是80，那么取200和80的最小值80，当前发送的字节数显然大于拥塞窗口，结论就是不能发送出去。

**发送窗口**和**拥塞窗口**的区别

1. 发送窗口反映了最为单TCP连接、点对点之间的流量控制模型，它是需要和接收端一起共同协调来调整大小的；
2. 拥塞窗口则反映了作为多个TCP连接共享带宽的拥塞控制模型，它是发送端独立地根据网络状况来动态调整的

#### 2. Nagle算法

Nagle算法的本质其实就是限制大批量的小数据包同时发送，它提出：在任何时刻，未被确认的小数据包（指长度小于最大报文段长的MSS的TCP分组）不能超过一个。这样，发送端就可以把接下来连续的几个小数据包存储起来，等待接收到前一个小数据包的ACK分组后，将数据一次性发送出去。

#### 3. 延迟ACK算法

延迟ACK在收到数据后并不马上回复，而是累计需要发送的ACK报文，等到有数据需要发送给对端时，将累计ACK捎带一并发送出去。当然延迟ACK并不能无限的延迟下去，否则发送端误认为数据报没有报送成功，引起重传，反而会占用额外的网络带宽。