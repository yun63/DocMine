游戏中的帧同步技术
==================

## 帧同步原理

## 帧同步设计要点

1. 逻辑部分去浮点数

> 浮点数用分子、分母表达

2. 组件做帧同步要求改造

3. 逻辑与“我”无关

4. 一致的随机数

> 随机数必须严格一致

5. **定位不同步的能力**

> 真正最重要的是开发者要提升自己发现不同步问题的能力，什么时候不同步了，不同步在什么地方。通过经验和总结提升这方面的能力。

6. 监控不同步的手段

## 网路问题

> 帧同步有点像在看电影，传统的帧同步需要有buffer，每个玩家输入会转发给所有客户端，相互会有编号，按顺序输入帧。

> 比如，我现在已经收到第N帧，只有当我收到第N+1帧的时候，第N帧才可以执行。服务器会按照一定的频率，不停地给所有客户端同步帧编号，包括这一帧的输入带给客户端。如果这一帧的数据客户端拿到之后就执行，但是下一帧数据还没来，结果就是卡顿。

网络绝对理想的情况下还好，但现实网络环境不是这样的。帧同步要解决的问题就是调试buffer，以前有动态buffer，它有1到n这样的缓冲区，根据网络抖动的情况，输入放到队列里。

这个buffer的大小会影响到延迟和卡顿。如果你的buffer越小，延迟就越低，你拿到以后不需要缓冲等待，马上就可以执行；但是如果下一帧还没来，buffer很小，你就不能执行，最终导致的结果是你的延迟还好，但是卡顿很明显。


## 延迟与卡顿优化措施

1. 无buffer帧同步

2. TCP换成UDP

3. 逻辑与表现分离

4. 本地插值平滑
